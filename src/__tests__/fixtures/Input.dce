<script>
  // Props
  let {
    value = '',
    type = 'text',
    placeholder = '',
    label = '',
    error = '',
    disabled = false,
    required = false,
    maxLength = null,
    onInput = null,
    onChange = null,
    onFocus = null,
    onBlur = null
  } = $props();

  // State
  let inputValue = $state(value);
  let isFocused = $state(false);
  let isDirty = $state(false);
  let characterCount = $state(0);

  // Derived
  let hasError = $derived(!!error);
  let showCharCount = $derived(maxLength !== null);
  let inputClass = $derived(
    `input ${hasError ? 'error' : ''} ${isFocused ? 'focused' : ''} ${disabled ? 'disabled' : ''}`
  );
  let isValid = $derived(!hasError && (!required || inputValue.length > 0));

  // Effects
  $effect(() => {
    if (inputValue !== value) {
      inputValue = value;
    }
  });

  $effect(() => {
    characterCount = inputValue.length;
  });

  // Functions
  function handleInput(event) {
    inputValue = event.target.value;
    isDirty = true;

    if (onInput) {
      onInput(event);
    }
  }

  function handleChange(event) {
    if (onChange) {
      onChange(event);
    }
  }

  function handleFocus(event) {
    isFocused = true;
    if (onFocus) {
      onFocus(event);
    }
  }

  function handleBlur(event) {
    isFocused = false;
    if (onBlur) {
      onBlur(event);
    }
  }
</script>

<template>
  <div class="input-wrapper">
    {#if label}
      <label class="input-label">
        {label}
        {#if required}
          <span class="required">*</span>
        {/if}
      </label>
    {/if}

    <input
      type={type}
      class={inputClass}
      value={inputValue}
      placeholder={placeholder}
      disabled={disabled}
      required={required}
      maxlength={maxLength}
      on:input={handleInput}
      on:change={handleChange}
      on:focus={handleFocus}
      on:blur={handleBlur}
    />

    {#if showCharCount}
      <div class="char-count">
        {characterCount} / {maxLength}
      </div>
    {/if}

    {#if hasError}
      <div class="error-message">
        {error}
      </div>
    {/if}
  </div>
</template>

<style>
  .input-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .input-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
  }

  .required {
    color: #ef4444;
    margin-left: 0.25rem;
  }

  .input {
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    outline: none;
    transition: all 0.2s;
    background: white;
    color: #111827;
  }

  .input:hover:not(:disabled) {
    border-color: #9ca3af;
  }

  .input.focused {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .input.error {
    border-color: #ef4444;
  }

  .input.error.focused {
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }

  .input.disabled {
    background: #f3f4f6;
    color: #9ca3af;
    cursor: not-allowed;
  }

  .input::placeholder {
    color: #9ca3af;
  }

  .char-count {
    font-size: 0.75rem;
    color: #6b7280;
    text-align: right;
  }

  .error-message {
    font-size: 0.875rem;
    color: #ef4444;
  }
</style>
